
<DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">
    <title>Document</title>
</head>
<body>
    <nav>
      {{!-- <h4>Node MySQL</h4> --}}
      <ul>
        <li><a href="/search">Search</a></li>
        <li><a href="/share">Share</a></li>
        <li><a href="/trips">Trips</a></li>
      </ul>
      <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/logout">Logout</a></li>
      </ul>
    </nav>
 
 <div class="container-fluid">
    <div class="row-fluid">
      <div id="share-bar">
        <!--Sidebar content-->
        <form action="/auth/share" method="post" class="form-horizontal well" id="share">
        <fieldset>
          <div id="share-route" class="control-group">
            <!-- From -->
            {{!-- <div class="control-group">
              <label class="control-label">From</label>
              <div class="controls">
                <input class="input-xlarge" id="share-from" name="from" type="text" placeholder="Type the name of a place or address over here">
              </div>
            </div> --}}
            <div>
              <label class="control-label">From</label>
              <div>
              <select id="from" name= "from">
                <option value="Byblos, Lebanon">Byblos</option>
                <option value="Jounieh, Lebanon">Jounieh</option>
                <option value="Antelias, Lebanon">Antelias</option>
                <option value="Daoura, Lebanon">Daoura</option>
                <option value="Beirut, Lebanon">Beirut</option>
            </select>
            </div>
          </div>

            <!-- To -->
            {{!-- <div class="control-group">
              <label class="control-label">To</label>
              <div class="controls">
                <input class="input-xlarge" id="share-to" name="to" type="text" placeholder="Type the name of a place or address over here">
              </div>
            </div>
          </div> --}}

          <div>
              <label class="control-label">From</label>
              <div>
              <select id="to" name= "to">
                <option value="Byblos, Lebanon">Byblos</option>
                <option value="Jounieh, Lebanon">Jounieh</option>
                <option value="Antelias, Lebanon">Antelias</option>
                <option value="Daoura, Lebanon">Daoura</option>
                <option value="Beirut, Lebanon">Beirut</option>
            </select>
            </div>
          </div>

          <!-- Departure -->
          <div class="control-group" id="share-departure">
            <label class="control-label">Departure</label>
            <div class="controls controls-row">
              <!-- Date Picker -->
              <div class="input-append date" id="share-departure-date" data-date="" data-date-format="dd-mm-yyyy">
                  <input type="date" value="2021-12-03" name='date' required>
              </div>
            

              <!-- Time Picker -->
              <div class="input-append bootstrap-timepicker">
                  <input type="time" name='time' id='time' value="22:48" required>
              </div>
            </div>
          </div>
            
          <!-- Trip Length -->
          <div class="control-group">
            <label class="control-label">Trip Length</label>
            <div class="controls">
              <input class="input-medium" id="share-trip-length" type="text" name="length">
            </div> 
          </div>

        
             <!-- Spots-->
           <div class="control-group">
            <label class="control-label" for="share-spots">Spots in Your Car</label>
           <div class="controls">
            <input type="number" class="input-medium" id="share-spots" name="spots" min="1" max="4" value="2" required>
         </div>
           </div>

        <div id="result" type='hidden'>
          <ul class="list-group">
            {{!-- <li id="in_mile">Distance In Mile :</li> --}}
            <li id="in_kilo">Distance is Kilo:</li>
            <li id='duration_text'>Duration:</li>
            {{!-- <li>IN MINUTES:</li>
            <li>FROM:</li>
            <li>TO:</li> --}}
          </ul>
        </div>
          {{!-- <!-- Women Only -->
          <div class="control-group" >
           <label class="checkbox">
            <div class="controls">
             <input type="checkbox" id="share-women-only">Women Only
             </div>
           </label>
          </div>

         
         <!-- Message -->
         <div class="control-group">
          <label class="control-label">Message</label>
          <div class="controls">
            <textarea id="share-message" class="input-xlarge" rows="5" placeholder="Message..."></textarea>
          </div>
         </div> --}}

         <!-- Share Button -->
         <div class="form-actions" >
           <button type="submit" id="share-button" class="btn btn-primary">Share</button>
         </div>
         </fieldset>
        </form><!-- End Sidebar Content -->
        {{#if message}}
              <h4 class="alert alert-danger mt-4">{{message}}</h4>
        {{/if}}
      </div>
      <div id="map" class="well"></div>
    </div>
  </div>

  <script>
        function initMap() {
          var directionsService = new google.maps.DirectionsService;
          var directionsDisplay = new google.maps.DirectionsRenderer;
          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 7,
            center: {lat: 34.1156, lng: 35.6744}
          });
          directionsDisplay.setMap(map);

          //calculateAndDisplayRoute(directionsService, directionsDisplay);
          
          var onChangeHandler = function() {
            calculateAndDisplayRoute(directionsService, directionsDisplay);
            calculateDistance();
          };
          document.getElementById('from').addEventListener('change', onChangeHandler);
          document.getElementById('to').addEventListener('change', onChangeHandler);
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
          directionsService.route({
            origin: document.getElementById('from').value,
            destination: document.getElementById('to').value,
            travelMode: 'DRIVING'
          }, function(response, status) {
            if (status === 'OK') {
              directionsDisplay.setDirections(response);
            } else {
              window.alert('Directions request failed due to ' + status);
            }
          }); 
        }
          function calculateDistance(){
            var DistanceMatrixService = new google.maps.DistanceMatrixService();
            var origin = document.getElementById('from').value;
            var destination = document.getElementById('to').value;
            DistanceMatrixService.getDistanceMatrix(
              {
                origins: [origin],
                destinations: [destination],
                travelMode: google.maps.TravelMode["DRIVING"],
                unitSystem: google.maps.UnitSystem.metric,
                avoidHighways: false,
                avoidTolls: false
              }, save_results);
          }
          function save_results(response, status) {

            if (status != google.maps.DistanceMatrixStatus.OK) {
                $('#result').html(err);
            } else {
                var origin = response.originAddresses[0];
                var destination = response.destinationAddresses[0];
                if (response.rows[0].elements[0].status === "ZERO_RESULTS") {
                    $('#result').html("Sorry , not available to use this travel mode between " + origin + " and " + destination);
                } else {
                    var distance = response.rows[0].elements[0].distance;
                    var duration = response.rows[0].elements[0].duration;
                    var distance_in_kilo = distance.value / 1000; // the kilo meter
                    var distance_in_mile = distance.value / 1609.34; // the mile
                    var duration_text = duration.text;
                    console.log(duration)
                    appendResults(distance_in_kilo, distance_in_mile, duration_text);
                }
            }
        }
        function appendResults(distance_in_kilo, distance_in_mile, duration_text) {
            document.getElementById("in_kilo").innerHTML= "Distance In Km:" + distance_in_kilo.toFixed(2);  
            document.getElementById("duration_text").innerHTML = "Duration: " + duration_text;
            document.getElementById("share-trip-length").value = duration_text;
        }
      </script>

      <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=API_KEY&callback=initMap"> 
      </script>

</body>
</html>